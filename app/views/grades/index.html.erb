<%= stylesheet_link_tag 'grades' %>

<script type="text/javascript" src="/javascripts/stats.js"></script>
<script type="text/javascript">
$(document).ready(function(e) {

	$('.item_row').click(function(e) {
		var item_id = $(this).attr('data-id');
		$.ajax({
		  type: 'GET',
		  url: '/grades/histogram/' + item_id + '.json',
		  success: function(data) {
		  	if (data.length == 0) {
		  		$('#histogram_container').fadeOut(300);
		  		return;
		  	}
		  	var categories = [],
		  		points = [];
		  	for (var i=0; i<data['points'].length; i++) {
		  		categories[i] = data['points'][i]['range'][0] + '-' + data['points'][i]['range'][1]
		  		points[i] = data['points'][i]['freq'];
		  	}
		  	
		  	var mean = data['mean'], 
		  		std_dev = data['std_dev'];
		  	var title = data['title']
		  		subtitle = 'Mean: ' + mean + '\tStd. Dev: ' + std_dev;
		  	var opts = {
		  		points: points,
		  		title: title,
		  		subtitle: subtitle,
		  		categories: categories
		  	};
		  	
		  	$.histogram('histogram_container', opts);
		  	$('#histogram_container').fadeIn(300);
		  },
		  dataType: 'json'
		});
	});
	
});
</script>

<%= render '/layouts/nav', :navigation =>
  [["Courses", courses_path],
  ["#{@course.dept} #{@course.number}", @course],
  ["Grades", url_for(:controller => :grades, :action => :index)]] %>

<div id="content">	
	<table id="grades_list">
	  <tr>
	  	<th>Item</th>
	  	<th>Pts. Received</th>
	  	<th>/</th>
	  	<th>Pts. Possible</th>
	  	<th></th>
	  </tr>
	
	<% total_pts = 0
	 total_possible = 0 
	%>
	<% @grades.each do |grade| %>
	 <% if grade.item.course == @course %>
	  <% total_pts += grade.points_received
	  	 total_possible += grade.item.points
	  %>
	  <tr class="item_row" data-id="<%= grade.item.id %>">
	    <td><span class="item_name"><%= grade.item.name %></span></td>
	    <td><%= format("%.2f", grade.points_received) %></td>
	    <td>/</td>
	    <td><%= grade.item.points %></td>
	    <% if grade.item.points != 0 %>
		  	<td><%= format("%.2f%%", ((grade.points_received)/(grade.item.points))*100) %></td>
		<% end %>
	  </tr>
	<% end %>
	<% end %>
	<% if total_possible != 0 %>
		<tr id="grade_totals">
			<td></td>
			<td><%= format("%.2f", total_pts) %></td>
			<td>/</td>
			<td><%= total_possible %></td>
		  	<td><%= format("%.2f%", (total_pts*100)/(total_possible)) %></td>
		</tr>
	<% end %>
	</table>
	
	<div id="histogram_container"></div>
</div>